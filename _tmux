#!/usr/bin/env bash
# shellcheck disable=

if ! command -v tmux &>/dev/null; then
  return
fi

export TP="${TMUX_PANE}"

alias kts='{ ebnis-save-tmux.sh || true; } && tmux kill-server'
alias tks='{ ebnis-save-tmux.sh || true; } && tmux kill-server'
alias ts='ebnis-save-tmux.sh'
alias trs='$HOME/.tmux/plugins/tmux-resurrect/scripts/restore.sh'

export TMUX_PLUGIN_MANAGER_PATH="$HOME/.tmux/plugins/"
tmux_session_wizard="$TMUX_PLUGIN_MANAGER_PATH/tmux-session-wizard/bin"
if [ -d "$tmux_session_wizard" ]; then
  pathmunge "$tmux_session_wizard"
fi

_c_tmux_script="$(_dot rt)/scripts/c-tmux"
if [[ -e "$_c_tmux_script" ]]; then
  chmod 755 "$_c_tmux_script"

  alias st='c-tmux start_tmux'
  alias tk='c-tmux kill_tmux'

  __fzf_tmux_sessions__() {
    local session_name
    # Get list of session names from c-tmux and fuzzy search
    # shellcheck disable=SC2091
    session_name=$(
      c-tmux list --names --no-flush |
        FZF_DEFAULT_OPTS=$(__fzf_defaults "--reverse" "${FZF_TMUX_SESSION_OPTS-} +m") \
        FZF_DEFAULT_OPTS_FILE='' $(__fzfcmd)
    ) || return
    # If a session was selected, copy its start command to clipboard
    if [[ -n "$session_name" ]]; then
      c-tmux list -fx "$session_name"
    fi
  }
  alias lt='__fzf_tmux_sessions__'
fi
unset _c_tmux_script
